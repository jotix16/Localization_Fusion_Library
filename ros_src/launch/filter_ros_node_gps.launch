<!-- Launch file for test_ekf_localization_node_bag1 -->
<!-- In this run, we ran a Clearpath Husky with a slightly broken Microstrain 3DM-GX2 IMU
     around a parking lot. The IMU was intentionally rotated +90 degrees about the X axis,
     then rotated (extrinsically) -90 degrees about the Z axis. -->


<launch>
    <arg name="imu_topic_list" default="[/imu/data]"/>
    <arg name="gps_topic_list" default="[/gps/fix]"/>

    <node pkg="tf2_ros" type="static_transform_publisher" name="map_odom"  args="0 0 0 0 0 0 map odom" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="odom_base" args="0 0 0 0 0 0 odom base_link" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_imu" args="0.10 0 0.91 0 0 1.5707963 base_link imu_link" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_house" args="0.0508 0 0.635 0 0 0 base_link house" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="house_gps" args="0.203210 0 0.254 0 0 0 gouse gps_link" />

    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find LocalizationFusionLibrary)/ros_src/rviz/config_file.rviz" />
    <node pkg="rosbag" type="play" name="rosbagplay" args="$(find LocalizationFusionLibrary)/test/utm_boundary_filtered.bag --clock -d 5 -s 0" required="true"/>

    <node name="filter_node" pkg="LocalizationFusionLibrary" type="filter_ros_node" output="screen">
      <param name="config" value="$(find LocalizationFusionLibrary)/ros_src/config/filter_config_gps.json"/>
      <param name="map_frame" value="map"/>
      <param name="odom_frame" value="odom"/>
      <param name="base_link_frame" value="base_link"/>

      <rosparam param="imu_topics" subst_value="True">$(arg imu_topic_list)</rosparam>
      <rosparam param="gps_topics" subst_value="True">$(arg gps_topic_list)</rosparam>
    </node>

</launch>
